### 2.生成、打包、部署和管理应用程序及类型

#### 2.1 .NET Framework部署目标

    Windows不稳定和口碑不佳的原因：

        1.所有应用程序都使用来自Microsoft或其他厂商的动态链接库（DLL）。当对于用户，当一
        家公司决定更新其软件产品的代码，并将新文件发送给他们是，就可能出现问题。还有可能安
        装新的应用程序时，他可能莫名其妙的破坏了另一个已经安装好的应用程序。这就是所谓的“
        DLL hell"

        2.安装的复杂性。大多数应用程序在安装时都会影响到系统的全部组件。例如，安装一个应用
        程序会将文件复制到多个目录，更新注册表并在桌面和开始菜单安装快捷方式。应用程序备份
        也不容易，想要复制只有再次运行安装程序才能确保正确。最后即时卸载了，也可能不干净

        3.安全性。安装应用程序会带来各种文件，其中有许多是由不同公司开发的，他们可能会造成
        各种各样的危害。

    小结：
        部署目标：
            1.NET Framework正在尝试彻底解决 DLL hell
            2.NET Framework在很大程度上解决了应用程序状态在硬盘中四处分散的问题
            3.安全性方面，.NET Framework包含称为“代码访问安全性”的安全模型，.NET Framew
            ork允许用户灵活控制那些东西能够安装，那些东西能够允许。

#### 2.2 将类型生成到模块中

    通过csc.exe来生成可执行文件 .exe
    csc.exe /out:Program.exe /t:exe /r:MSCorLib.dll Program.cs

    .exe这个文件到底是什么？
        首先它是标准PE（可移植执行体）文件，这意味着windows计算机能加载他，并通过他执行某
        些操作。

    Windows支持三种应用程序：
        CUI 
        GUI 
        Windows Store应用

#### 2.3 元数据概述

    托管PE文件由4部分构成：

        第一部分：
            PE32(+)头:Windows要求的标准信息
        第二部分：
            CLR头:是一个小的信息块，是需要CLR的模块特有的。这个头包含了：
                模块生成时所面向的CLR的major(主)和minor(次)版本号;
                一些标志(flag);
                一个MethodDef token,该token指定了模块的入口方法(前提是该模块式CUI、G
                UI或Windows Store执行体);
                一个可选的强名称数字签名;
                模块内部的一些元数据表的大小和偏移量
        第三部分：
            元数据
        第四部分：
            IL
    
    元数据是由几个表构成的二进制数据块。有三种表，分别是定义表、引用表和清单表。

    定义表：
        编译器编译源代码时,代码所定义的任何东西都都导致在元数据定义表中的某个表中创建一个
        记录项。
    
    引用表：
        此外编译器还会检测源代码引用的类型、字段、方法、属性和事件,并创建相应的元数据表记
        录项。该表记录了所引用的内容。

    清单表：
        表中主要包含作为程序集组成部分的那些文件的名称。还描述了程序集的版本、语言文化、发
        布者、公开导出的类型以及构成程序集的所有文件。

    Program.exe包含名为Program的TypeDef。Program是公共密封类，从System.Object派生,Pro
    gram类型还定义了两个方法：Main和.ctor(构造器)

#### 2.4 将模块合并成程序集

    Program.exe并非是只含有元数据的PE文件,它还是程序集。

    程序集（assembly）：
        是一个或多个类型定义文件及资源文件的集合。在程序集的所有文件中，有一个文件容纳了清
        单。

    CLR操作的是程序集。换言之,CLR总是首先加载包含“清单”元数据表的文件，在根据“清单”来获取
    程序集中的其他文件的名称。

    程序集的特点：
        程序集定义了可重用的类型
        程序集用一个版本号标记
        程序集可以关联安全信息
    除了包含清单元数据表的文件、程序集其他单独的文件并不具备上述特点

    为了配置应用程序去下载程序集文件，可在应用程序配置文件中指定codeBase元素。

    使用多文件程序集的三点理由：

        1.不同类型用不同的文件，使文件能以“增量”方式下载。另外，将类型划分到不同的文件中，
        可以对购买或者安装的应用程序进行部分或分批打包/部署

        2.可在程序集中添加资源或数据文件。

        3.程序集包含的各个类型可以用不同的编程语言来实现。

    程序集是进行重用、版本控制和应用安全性设置的基本单元。一旦CLR加载含有清单的文件，就可
    以确定在程序集的其他文件中，具体是哪一些文件包含应用程序引用的类型和资源。

            
